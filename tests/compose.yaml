services:
  db:
    image: postgres:12
    environment:
      POSTGRES_USER: odoo
      POSTGRES_PASSWORD: odoo
      POSTGRES_DB: postgres
    healthcheck:
      test: [ "CMD", "pg_isready" ]
      interval: 10s
      timeout: 15s
      retries: 12
  odoo:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        DOCKER_REPO: ${DOCKER_REPO:-docker-odoo}
        DOCKER_TAG: ${DOCKER_TAG:-master}
    environment:
      PGHOST: db
      PGUSER: odoo
      PGPASSWORD: odoo
      PGDATABASE: testdb
      PGTIMEOUT: 30
      WITHOUT_DEMO: "false"
      UNACCENT: "false"
      PROXY_MODE: "false"
      WORKERS: "0"
    depends_on:
      - db
